<div id="centerpage">
  <%= render 'shared/tabs' %>
  <div id="mainpagewrap" style="width: 900px; height:740px; margin: 0 auto; margin-bottom:10px;">
    <div class="box effect1">
      <h2>
        <%= @submission.name %>
      </h2>
    </div>
    <div class="mainpageleft">
      <div class="infosection effect3">
        <div class='sidebar'>
          <% if !@submission.ready? %>
          <p class="title" style="margin-top: 0px; margin-bottom: 0px;"><%= t '.warning_title' %></p>
          <p class="uploadby" style="margin-top: 5px;">
            <b><%= t '.warning_text' %></b>
          </p>
          <% else %>
          <% if @submission.latest_download %>
          <% latest = @submission.latest_download %>
          <div class="downloadbutton">
            <a href="<%= submission_download_path(@submission) %>">
              <h4 class="download">
                <%= t '.download' %>
                <div class="filename">
                  <%= @submission.latest_download.upload.truncated_name %>
                  <% size = latest.upload.download_size %>
                  (<%= t '.upload_size', :size => (size[0]), :unit => (size[1]) %>)
                </div>
              </h4>
            </a>
          </div>
          <% end %>
          <% end %>
          <p class="title">
            <%= best_in_place_if can_manage(@submission), @submission, :name, :as => :input, tabindex: "1" %>
          </p>
          <p class="dateupload" title="<%= 'Uploaded ' + time_ago_in_words(@submission.created_at) + ' ago' %>">
            <%= @submission.created_at.strftime("%B #{@submission.created_at.day.ordinalize}, #{@submission.created_at.year}") %>
          </p>
          <p class="description">
            <%= best_in_place_if can_manage(@submission), @submission, :body, :as => :textarea, tabindex: "2", class: 'description_filter', :data => {:description => @submission.body}, raw: true, :display_with => lambda { |v| sanitize(v).gsub(/(\r)?\n/, "<br/>").html_safe } %>
          </p>
          <p class="uploadby">
            <b><%= t '.created_by' %></b>
          </p>
          <div class="profile">
            <a href="<%= user_uploads_path(@submission.user.username) %>">
              <%= avatar(@submission.user) %>
            </a>
            <div class="persondetails">
              <div class="username">
                <%= link_to @submission.user.username, user_uploads_path(@submission.user.username) %>
              </div>
              <div class="userdescription"><%= t '.map_maker' %></div>
              <div class="stats">
                <%= pluralize(@submission.user.submissions.count, "#{t '.submission'}") %>
              </div>
            </div>
          </div>
          <p class="uploadby">
            <b>
              <%= pluralize(@submission.download_count, "#{t '.download'}") %>
            </b>
          </p>
          <div class="manage">
           <p class="uploadby" style="margin: 0px;">
            <a class="report-submission-button" href="#add-report-submission">
              <b><%= t '.report_submission' %></b>
            </a>
           </p>
          </div>
          <%= render 'reports/form', reportable: [@submission] %>
          <div class="manage">
            <% if can_manage(@submission) %>
            <p class="title" style="margin-bottom: 3px; margin-top: 2px;"><%= t '.manage' %></p>
            <div class="manage">
              <p class="uploadby" style="margin: 0px;">
                <a href="<%= new_submission_upload_path(@submission) %>">
                  <b><%= t '.upload_file' %></b>
                </a>
                <br/>
                <a href="<%= new_submission_image_path(@submission) %>">
                  <b><%= t '.upload_image' %></b>
                </a>
                <br/>
                <a href="<%= edit_submission_path(@submission) %>">
                  <b><%= t '.edit' %></b>
                </a>
                <br/>
                <b>
                  <%= link_to (t '.delete'), submission_path(@submission), method: :delete, data: {confirm: 'Are you sure you want to delete this submission? This can not be undone.'} %>
                </b>
                <% if user_is_admin %>
                <br/>
                <a href="<%= submission_favorite_path(@submission) %>">
                  <b><%= t '.favorite' %></b>
                </a>
                <% end %>
              </p>
            </div>
            <% end %>
          </div>
          <%= render 'videos/display' %>
          <%= render 'videos/popup' %>
        </div>
      </div>
    </div>
    <div class="mainpageright">
      <div class="rightbar">
        <%= render 'images' %>
        <%= render 'comments/display' %>
      </div>
    </div>
    <div id="mainpage"></div>
  </div>
</div>
<script>
  // init best_in_place
  $(".best_in_place").best_in_place();
  // Handles description formatting
  $('.description_filter').bind("ajax:success", function () {
    $('.description_filter').html($('.description_filter').html().replace(/(\r)?\n/g, "<br/>")) // Replace new lines
  });
  // Handles animation
  $('.best_in_place').bind("ajax:success", function () {
    $(this).effect('highlight', {color: 'lightgreen'}, 1800);
  });
</script>